<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="Phillip Alday" />
  <meta name="author" content="Dave Kleinschmidt" />
  <meta name="author" content="Reinhold Kliegl" />
  <meta name="author" content="Douglas Bates" />
  <title>The dyestuff and dyestuff2 data - Embrace Uncertainty</title>
  <link rel="shortcut icon" type="image/png" href="/favicon.png"/>
  <link rel="stylesheet" href="/style.css"/>
    <script src="/mousetrap.min.js"></script>
    <!-- TODO: Add url_prefix. -->
  <style>
  @font-face {
    font-family: JuliaMono-Regular;
    src: url("/JuliaMono-Regular.woff2");
  }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
  <link rel="stylesheet" href="/github.min.css">
<script src="/highlight.min.js"></script>
<script src="/julia.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', (event) => {
    document.querySelectorAll('pre').forEach((el) => {
        hljs.highlightElement(el);
    });
});
</script>
 
</head>
<body>
<script>
function click_next() {
  var next = document.getElementById('nav-next');
  next.firstElementChild.nextElementSibling.click();
}
function click_prev() {
  var prev = document.getElementById('nav-prev');
  prev.firstElementChild.click();
}
Mousetrap.bind('right', click_next);
Mousetrap.bind('h', click_prev);
Mousetrap.bind('left', click_prev);
Mousetrap.bind('l', click_next);
</script>

<div class="books-container">
<aside class="books-menu">
<input type="checkbox" id="menu">
<label for="menu">☰</label>
<div class="books-title">
<a href="/">Embrace Uncertainty</a>
</div><br />
<span class="books-subtitle">
Fitting Mixed-Effects Models with Julia
</span>
<div class="books-menu-content">
<li><a class="menu-level-1" href="/ExamLMM"><b>1</b> A Simple, Linear, Mixed-..</a></li>
<li><a class="menu-level-2" href="/memod"><b>1.1</b> Mixed-effects models</a></li>
<li><a class="menu-level-2" href="/DyestuffData"><b>1.2</b> The dyestuff and dyest..</a></li>
<li><a class="menu-level-2" href="/FittingLMMs"><b>1.3</b> Fitting linear mixed m..</a></li>
<li><a class="menu-level-2" href="/Probability"><b>1.4</b> The linear mixed-effec..</a></li>
<li><a class="menu-level-2" href="/variability"><b>1.5</b> Assessing the variabil..</a></li>
<li><a class="menu-level-2" href="/assessRE"><b>1.6</b> Assessing the random e..</a></li>
<li><a class="menu-level-2" href="/ChIntroSummary"><b>1.7</b> Chapter summary</a></li>
<li><a class="menu-level-1" href="/Multiple"><b>2</b> Models With Multiple Ran..</a></li>
<li><a class="menu-level-2" href="/crossedRE"><b>2.1</b> A Model With Crossed R..</a></li>
<li><a class="menu-level-2" href="/NestedRE"><b>2.2</b> A Model With Nested Ra..</a></li>
<li><a class="menu-level-2" href="/partially"><b>2.3</b> A Model With Partially..</a></li>
<li><a class="menu-level-2" href="/MultSummary"><b>2.4</b> Chapter Summary</a></li>
<li><a class="menu-level-1" href="/longitudinal"><b>3</b> # Models for Longitudina..</a></li>
<li><a class="menu-level-2" href="/sleep"><b>3.1</b> Data</a></li>
<li><a class="menu-level-2" href="/SleepMixed"><b>3.2</b> Data</a></li>
<li><a class="menu-level-2" href="/assess-prec-param"><b>3.3</b> Assessing the Precisio..</a></li>
<li><a class="menu-level-2" href="/fm07re"><b>3.4</b> Examining the Random E..</a></li>
<li><a class="menu-level-2" href="/chapter-summary"><b>3.5</b> Chapter Summary</a></li>
<li><a class="menu-level-1" href="/computational"><b>4</b> Computational Methods fo..</a></li>
<li><a class="menu-level-2" href="/defnLMM"><b>4.1</b> Definitions and Basic ..</a></li>
<li><a class="menu-level-2" href="/conddistUgivenY"><b>4.2</b> </a></li>
<li><a class="menu-level-2" href="/IntegratingH"><b>4.3</b> in the Linear Mixed Mo..</a></li>
<li><a class="menu-level-2" href="/PLSsol"><b>4.4</b> </a></li>
<li><a class="menu-level-2" href="/REML"><b>4.5</b> The REML Criterion</a></li>
<li><a class="menu-level-2" href="/stepByStep"><b>4.6</b> Step-by-step Evaluatio..</a></li>
<li><a class="menu-level-2" href="/general"><b>4.7</b> Generalizing to Other ..</a></li>
<li><a class="menu-level-2" href="/lmmsummary"><b>4.8</b> Chapter Summary</a></li>
<li><a class="menu-level-1" href="/GLMMbinomial"><b>5</b> Generalized Linear Mixed..</a></li>
<li><a class="menu-level-2" href="/contraception"><b>5.1</b> Artificial contracepti..</a></li>
<li><a class="menu-level-2" href="/GLMMlink"><b>5.2</b> Link functions and int..</a></li>
<li><a class="menu-level-1" href="/references"><b></b> References</a></li>
</div>
</aside>

<div class="books-content">
<h2 data-number="1.2" id="sec:DyestuffData"><span class="header-section-number">1.2</span> The dyestuff and dyestuff2 data</h2>
<p>Models with random effects have been in use for a long time. The first edition of the classic book, <em>Statistical Methods in Research and Production</em>, edited by O.L. Davies, was published in 1947 and contained examples of the use of random effects to characterize batch-to-batch variability in chemical processes. The data from one of these examples are available as the <code>dyestuff</code> data in the <code>MixedModels</code> package. In this section we describe and plot these data and introduce a second example, the <code>dyestuff2</code> data, described in <span class="citation" data-cites="box73:_bayes_infer_statis_analy"><a href="/references#ref-box73:_bayes_infer_statis_analy" role="doc-biblioref">Box &amp; Tiao</a> (<a href="/references#ref-box73:_bayes_infer_statis_analy" role="doc-biblioref">1973</a>)</span>.</p>
<h3 data-number="1.2.1" id="sec:dyestuff"><span class="header-section-number">1.2.1</span> The dyestuff data</h3>
<p>The data are described in <span class="citation" data-cites="davies72:_statis_method_in_resear_and_produc"><a href="/references#ref-davies72:_statis_method_in_resear_and_produc" role="doc-biblioref">Davies &amp; Goldsmith</a> (<a href="/references#ref-davies72:_statis_method_in_resear_and_produc" role="doc-biblioref">1972</a>, Table 6.3, p. 131)</span>, the fourth edition of the book mentioned above, as coming from</p>
<blockquote>
<p>an investigation to find out how much the variation from batch to batch in the quality of an intermediate product (H-acid) contributes to the variation in the yield of the dyestuff (Naphthalene Black 12B) made from it. In the experiment six samples of the intermediate, representing different batches of works manufacture, were obtained, and five preparations of the dyestuff were made in the laboratory from each sample. The equivalent yield of each preparation as grams of standard colour was determined by dye-trial.</p>
</blockquote>
<p>To access these data within <code>Julia</code> we must first attach this package, and others that we will use, to our session with</p>
<pre class="julia"><code>using DataFrameMacros, DataFrames, MixedModels</code></pre>
<p>A package must be attached before any of the data sets or functions in the package can be used. If entering this line results in an error report stating that there is no package by one of these names then you must first install the package(s). The error report should include instructions for how to do this.</p>
<p>In what follows, we will assume that these packages have been installed and attached to the session before any of the code shown has been run.</p>
<p>The <code>MixedModels</code> package includes several datasets that are used in examples and in tests of the package. Individual datasets can be loaded with the <code>dataset</code> function. To allow for other packages to incorporate their own <code>dataset</code> function without causing name clashes, this function is not exported and must be called with the fully-qualified name <code>MixedModels.dataset</code>. (If this explanation sounds like gibberish to you, the bottom line is that you must use <code>MixedModels.dataset(:dyestuff)</code> and not just <code>dataset(:dyestuff)</code>.)</p>
<pre class="language-julia"><code>dyestuff = MixedModels.dataset(:dyestuff)</code></pre>
<pre class="output"><code>Arrow.Table with 30 rows, 2 columns, and schema:
 :batch  String
 :yield  Int16</code></pre>
<p>The output indicates that this dataset is a <code>Table</code> read from a file in the <a href="https://arrow.apache.org">Arrow</a> data format.</p>
<p>A <code>Table</code> is a general, but “bare bones,” tabular form defined in the <a href="https://github.com/JuliaData/Tables.jl">Tables</a> package. This particular table, read from an <code>Arrow</code> file, will be read-only. It is often convenient to convert the read-only table form to a <code>DataFrame</code> to be able to use the full power of the <a href="https://github.com/JuliaData/DataFrames.jl">DataFrames</a> package.</p>
<pre class="language-julia"><code>dyestuff = DataFrame(dyestuff)</code></pre>
<p>The <code>describe</code> method for a <code>DataFrame</code> provides a concise description of the structure of the data,</p>
<pre class="language-julia"><code>describe(dyestuff)</code></pre>
<table>
<thead>
<tr class="header">
<th style="text-align: right;">variable</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">min</th>
<th style="text-align: right;">median</th>
<th style="text-align: right;">max</th>
<th style="text-align: right;">nmissing</th>
<th style="text-align: right;">eltype</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">batch</td>
<td style="text-align: right;">nothing</td>
<td style="text-align: right;">A</td>
<td style="text-align: right;">nothing</td>
<td style="text-align: right;">F</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">String</td>
</tr>
<tr class="even">
<td style="text-align: right;">yield</td>
<td style="text-align: right;">1527.5</td>
<td style="text-align: right;">1440</td>
<td style="text-align: right;">1530.0</td>
<td style="text-align: right;">1635</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">Int16</td>
</tr>
</tbody>
</table>
<p>from which we see that it consists of 30 observations of the <code>yield</code>, the response variable, and of the covariate, <code>batch</code>, which is a categorical variable whose levels are character strings.</p>
<pre class="language-julia"><code>typeof(dyestuff.batch)</code></pre>
<pre class="output"><code>Arrow.DictEncoded{String, Int8, Arrow.List{String, Int32, Vector{UInt8}}}</code></pre>
<p>(<code>DictEncoded</code> is the <code>Arrow</code> term for a categorical structure where the levels form a dictionary or lookup table and the values are stored as indices into this lookup table.)</p>
<pre class="language-julia"><code>levels(dyestuff.batch)</code></pre>
<pre class="output"><code>[&quot;A&quot;, &quot;B&quot;, &quot;C&quot;, &quot;D&quot;, &quot;E&quot;, &quot;F&quot;]</code></pre>
<p>If the labels for the factor levels are arbitrary, as they are here, we will use letters instead of numbers for the labels. That is, we label the batches as <code>"A"</code> through <code>"F"</code> rather than <code>1</code> through <code>6</code>. When the labels are letters it is clear that the variable is categorical. When the labels are numbers a categorical covariate can be mistaken for a numeric covariate, with unintended consequences.</p>
<p>It is a good practice to apply <code>describe</code> to any data frame the first time you work with it and to check carefully that any categorical variables are indeed represented as factors.</p>
<p>The data in a data frame are viewed as a table with columns corresponding to variables and rows to observations. The functions <code>first</code> and <code>last</code> the first or last few rows</p>
<pre class="language-julia"><code>first(dyestuff, 7)</code></pre>
<table>
<thead>
<tr class="header">
<th style="text-align: right;">batch</th>
<th style="text-align: right;">yield</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">A</td>
<td style="text-align: right;">1545</td>
</tr>
<tr class="even">
<td style="text-align: right;">A</td>
<td style="text-align: right;">1440</td>
</tr>
<tr class="odd">
<td style="text-align: right;">A</td>
<td style="text-align: right;">1440</td>
</tr>
<tr class="even">
<td style="text-align: right;">A</td>
<td style="text-align: right;">1520</td>
</tr>
<tr class="odd">
<td style="text-align: right;">A</td>
<td style="text-align: right;">1580</td>
</tr>
<tr class="even">
<td style="text-align: right;">B</td>
<td style="text-align: right;">1540</td>
</tr>
<tr class="odd">
<td style="text-align: right;">B</td>
<td style="text-align: right;">1555</td>
</tr>
</tbody>
</table>
<pre class="language-julia"><code>last(dyestuff, 7)</code></pre>
<table>
<thead>
<tr class="header">
<th style="text-align: right;">batch</th>
<th style="text-align: right;">yield</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">E</td>
<td style="text-align: right;">1635</td>
</tr>
<tr class="even">
<td style="text-align: right;">E</td>
<td style="text-align: right;">1625</td>
</tr>
<tr class="odd">
<td style="text-align: right;">F</td>
<td style="text-align: right;">1520</td>
</tr>
<tr class="even">
<td style="text-align: right;">F</td>
<td style="text-align: right;">1455</td>
</tr>
<tr class="odd">
<td style="text-align: right;">F</td>
<td style="text-align: right;">1450</td>
</tr>
<tr class="even">
<td style="text-align: right;">F</td>
<td style="text-align: right;">1480</td>
</tr>
<tr class="odd">
<td style="text-align: right;">F</td>
<td style="text-align: right;">1445</td>
</tr>
</tbody>
</table>
<p>or we could tabulate the data using <code>DataFrames.groupby</code> and the <code>@combine</code> macro from the <a href="https://github.com/jkrumbiegel/DataFrameMacros.jl">DataFrameMacros</a> package.</p>
<pre class="language-julia"><code>@combine(groupby(dyestuff, :batch), :mean_yield = mean(:yield), :n = length(:yield))</code></pre>
<div id="tbl:mean_yield">
<table>
<caption>Table 1: Mean yield by batch of dyestuff</caption>
<thead>
<tr class="header">
<th style="text-align: right;">batch</th>
<th style="text-align: right;">mean_yield</th>
<th style="text-align: right;">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">A</td>
<td style="text-align: right;">1505.0</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="even">
<td style="text-align: right;">B</td>
<td style="text-align: right;">1528.0</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="odd">
<td style="text-align: right;">C</td>
<td style="text-align: right;">1564.0</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="even">
<td style="text-align: right;">D</td>
<td style="text-align: right;">1498.0</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="odd">
<td style="text-align: right;">E</td>
<td style="text-align: right;">1600.0</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="even">
<td style="text-align: right;">F</td>
<td style="text-align: right;">1470.0</td>
<td style="text-align: right;">5</td>
</tr>
</tbody>
</table>
</div>
<p>Although Table <a href="#tbl:mean_yield">1</a> does show us an important property of the data, namely that there are exactly <span class="math inline">\(5\)</span> observations on each batch — a property that we will describe by saying that the data are <em>balanced</em> with respect to <code>batch</code> — we usually learn much more about the structure of such data from plots like</p>
<figure>
<img src="/im/EU_dyestuffdataplot_.svg" id="fig:dyestuffdata" alt="Figure 1: Yield of dyestuff by batch. The line joins the mean yields." /><figcaption aria-hidden="true">Figure 1: Yield of dyestuff by batch. The line joins the mean yields.</figcaption>
</figure>
<p>than we do from numerical summaries.</p>
<p>In Figure <a href="#fig:dyestuffdata">1</a> we can see that there is considerable variability in yield, even for preparations from the same batch, but there is also noticeable batch-to-batch variability. For example, four of the five preparations from batch F provided lower yields than did any of the preparations from batches C and E.</p>
<p>This plot, and essentially all the other plots in this book, were created using the <a href="https://makie.juliaplots.io">Makie</a> package (<span class="citation" data-cites="DanischKrumbiegel2021"><a href="/references#ref-DanischKrumbiegel2021" role="doc-biblioref">Danisch &amp; Krumbiegel</a> (<a href="/references#ref-DanischKrumbiegel2021" role="doc-biblioref">2021</a>)</span>).</p>
<p>In <code>yet-to-be-written-appendix</code> we review some of the principles of data graphics, such as reordering the levels of the factor by increasing mean response, that enhance the informativeness of the plot. For example, in this plot the levels of <code>batch</code> are sorted by increasing mean yield, to make visual comparisons between batches easier, and the vertical positions are <em>jittered</em> to avoid overplotting of points. (Note that the two lowest yields of samples from batch <code>A</code> are identical.) At this point we will concentrate on the information conveyed by the plot and not on how the plot is created.</p>
<p>In Section <a href="/FittingLMMs#sec:FittingLMMs">1.3</a> we will use mixed models to quantify the variability in yield between batches. For the time being let us just note that the particular batches used in this experiment are a selection or sample from the set of all batches that we wish to consider. Furthermore, the extent to which one particular batch tends to increase or decrease the mean yield of the process — in other words, the “effect” of that particular batch on the yield — is not as interesting to us as is the extent of the variability between batches. For the purposes of designing, monitoring and controlling a process we want to predict the yield from future batches, taking into account the batch-to-batch variability and the within-batch variability. Being able to estimate the extent to which a particular batch in the past increased or decreased the yield is not usually an important goal for us. We will model the effects of the batches as random effects rather than as fixed-effects parameters.</p>
<h3 data-number="1.2.2" id="sec:dyestuff2"><span class="header-section-number">1.2.2</span> The dyestuff2 data</h3>
<p>The data are simulated data presented in <span class="citation" data-cites="box73:_bayes_infer_statis_analy"><a href="/references#ref-box73:_bayes_infer_statis_analy" role="doc-biblioref">Box &amp; Tiao</a> (<a href="/references#ref-box73:_bayes_infer_statis_analy" role="doc-biblioref">1973</a>, Table 5.1.4, p. 247)</span> where the authors state</p>
<blockquote>
<p>These data had to be constructed for although examples of this sort undoubtedly occur in practice they seem to be rarely published.</p>
</blockquote>
<p>The structure and summary</p>
<pre class="language-julia"><code>dyestuff2 = MixedModels.dataset(:dyestuff2)</code></pre>
<pre class="output"><code>Arrow.Table with 30 rows, 2 columns, and schema:
 :batch  String
 :yield  Float64</code></pre>
<pre class="language-julia"><code>dyestuff2 = DataFrame(dyestuff2)
describe(dyestuff2)</code></pre>
<table>
<thead>
<tr class="header">
<th style="text-align: right;">variable</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">min</th>
<th style="text-align: right;">median</th>
<th style="text-align: right;">max</th>
<th style="text-align: right;">nmissing</th>
<th style="text-align: right;">eltype</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">batch</td>
<td style="text-align: right;">nothing</td>
<td style="text-align: right;">A</td>
<td style="text-align: right;">nothing</td>
<td style="text-align: right;">F</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">String</td>
</tr>
<tr class="even">
<td style="text-align: right;">yield</td>
<td style="text-align: right;">5.6656</td>
<td style="text-align: right;">-0.892</td>
<td style="text-align: right;">5.365</td>
<td style="text-align: right;">13.434</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">Float64</td>
</tr>
</tbody>
</table>
<p>are intentionally similar to those of the <code>dyestuff</code> data.</p>
<p>A data plot (Figure <a href="#fig:dyestuff2data">2</a>)</p>
<figure>
<img src="/im/EU_dyestuff2dataplot_.svg" id="fig:dyestuff2data" alt="Figure 2: Artificial data of yield by batch. The line joins the mean yields." /><figcaption aria-hidden="true">Figure 2: Artificial data of yield by batch. The line joins the mean yields.</figcaption>
</figure>
<p>shows that the batch-to-batch variability in these data is small compared to the within-batch variability.</p>
<p>In some approaches to mixed models it can be difficult to fit models to such data. Paradoxically, small “variance components” can be more difficult to estimate than large variance components.</p>
<p>The methods we will present are not compromised when estimating small variance components.</p>


<div class="bottom-nav">
    <p id="nav-prev" style="text-align: left;">
        <a class="menu-level-2" href="/memod"><b>1.1</b> Mixed-effects models</a> <kbd>←</kbd>
        <span id="nav-next" style="float: right;">
            <kbd>→</kbd> <a class="menu-level-2" href="/FittingLMMs"><b>1.3</b> Fitting linear mixed m..</a>
        </span>
    </p>
</div>


<div class="license">
    <br/>
  <br/>
  <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a>
    Phillip Alday, Dave Kleinschmidt, Reinhold Kliegl, Douglas Bates
</div>
</div>
</div>
</body>
</html>