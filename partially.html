<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="Phillip Alday" />
  <meta name="author" content="Dave Kleinschmidt" />
  <meta name="author" content="Reinhold Kliegl" />
  <meta name="author" content="Douglas Bates" />
  <title>A Model With Partially Crossed Random Effects - Embrace Uncertainty</title>
  <link rel="shortcut icon" type="image/png" href="/favicon.png"/>
  <link rel="stylesheet" href="/style.css"/>
    <script src="/mousetrap.min.js"></script>
    <!-- TODO: Add url_prefix. -->
  <style>
  @font-face {
    font-family: JuliaMono-Regular;
    src: url("/JuliaMono-Regular.woff2");
  }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
  <link rel="stylesheet" href="/github.min.css">
<script src="/highlight.min.js"></script>
<script src="/julia.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', (event) => {
    document.querySelectorAll('pre').forEach((el) => {
        hljs.highlightElement(el);
    });
});
</script>
 
</head>
<body>
<script>
function click_next() {
  var next = document.getElementById('nav-next');
  next.firstElementChild.nextElementSibling.click();
}
function click_prev() {
  var prev = document.getElementById('nav-prev');
  prev.firstElementChild.click();
}
Mousetrap.bind('right', click_next);
Mousetrap.bind('h', click_prev);
Mousetrap.bind('left', click_prev);
Mousetrap.bind('l', click_next);
</script>

<div class="books-container">
<aside class="books-menu">
<input type="checkbox" id="menu">
<label for="menu">☰</label>
<div class="books-title">
<a href="/">Embrace Uncertainty</a>
</div><br />
<span class="books-subtitle">
Fitting Mixed-Effects Models with Julia
</span>
<div class="books-menu-content">
<li><a class="menu-level-1" href="/ExamLMM"><b>1</b> A Simple, Linear, Mixed-..</a></li>
<li><a class="menu-level-2" href="/memod"><b>1.1</b> Mixed-effects models</a></li>
<li><a class="menu-level-2" href="/DyestuffData"><b>1.2</b> The dyestuff and dyest..</a></li>
<li><a class="menu-level-2" href="/FittingLMMs"><b>1.3</b> Fitting linear mixed m..</a></li>
<li><a class="menu-level-2" href="/Probability"><b>1.4</b> The linear mixed-effec..</a></li>
<li><a class="menu-level-2" href="/variability"><b>1.5</b> Assessing the variabil..</a></li>
<li><a class="menu-level-2" href="/assessRE"><b>1.6</b> Assessing the random e..</a></li>
<li><a class="menu-level-2" href="/ChIntroSummary"><b>1.7</b> Chapter summary</a></li>
<li><a class="menu-level-1" href="/Multiple"><b>2</b> Models With Multiple Ran..</a></li>
<li><a class="menu-level-2" href="/crossedRE"><b>2.1</b> A Model With Crossed R..</a></li>
<li><a class="menu-level-2" href="/NestedRE"><b>2.2</b> A Model With Nested Ra..</a></li>
<li><a class="menu-level-2" href="/partially"><b>2.3</b> A Model With Partially..</a></li>
<li><a class="menu-level-2" href="/MultSummary"><b>2.4</b> Chapter Summary</a></li>
<li><a class="menu-level-1" href="/longitudinal"><b>3</b> # Models for Longitudina..</a></li>
<li><a class="menu-level-2" href="/sleep"><b>3.1</b> Data</a></li>
<li><a class="menu-level-2" href="/SleepMixed"><b>3.2</b> Data</a></li>
<li><a class="menu-level-2" href="/assess-prec-param"><b>3.3</b> Assessing the Precisio..</a></li>
<li><a class="menu-level-2" href="/fm07re"><b>3.4</b> Examining the Random E..</a></li>
<li><a class="menu-level-2" href="/chapter-summary"><b>3.5</b> Chapter Summary</a></li>
<li><a class="menu-level-1" href="/computational"><b>4</b> Computational Methods fo..</a></li>
<li><a class="menu-level-2" href="/defnLMM"><b>4.1</b> Definitions and Basic ..</a></li>
<li><a class="menu-level-2" href="/conddistUgivenY"><b>4.2</b> </a></li>
<li><a class="menu-level-2" href="/IntegratingH"><b>4.3</b> in the Linear Mixed Mo..</a></li>
<li><a class="menu-level-2" href="/PLSsol"><b>4.4</b> </a></li>
<li><a class="menu-level-2" href="/REML"><b>4.5</b> The REML Criterion</a></li>
<li><a class="menu-level-2" href="/stepByStep"><b>4.6</b> Step-by-step Evaluatio..</a></li>
<li><a class="menu-level-2" href="/general"><b>4.7</b> Generalizing to Other ..</a></li>
<li><a class="menu-level-2" href="/lmmsummary"><b>4.8</b> Chapter Summary</a></li>
<li><a class="menu-level-1" href="/GLMMbinomial"><b>5</b> Generalized Linear Mixed..</a></li>
<li><a class="menu-level-2" href="/contraception"><b>5.1</b> Artificial contracepti..</a></li>
<li><a class="menu-level-2" href="/GLMMlink"><b>5.2</b> Link functions and int..</a></li>
<li><a class="menu-level-1" href="/references"><b></b> References</a></li>
</div>
</aside>

<div class="books-content">
<h2 data-number="2.3" id="sec:partially"><span class="header-section-number">2.3</span> A Model With Partially Crossed Random Effects</h2>
<p>Especially in observational studies with multiple grouping factors, the configuration of the factors frequently ends up neither nested nor completely crossed. We describe such situations as having <em>partially crossed</em> grouping factors for the random effects.</p>
<p>Studies in education, in which test scores for students over time are also associated with teachers and schools, usually result in partially crossed grouping factors. If students with scores in multiple years have different teachers for the different years, the student factor cannot be nested within the teacher factor. Conversely, student and teacher factors are not expected to be completely crossed. To have complete crossing of the student and teacher factors it would be necessary for each student to be observed with each teacher, which would be unusual. A longitudinal study of thousands of students with hundreds of different teachers inevitably ends up partially crossed.</p>
<p>In this section we consider an example with thousands of students and instructors where the response is the student’s evaluation of the instructor’s effectiveness. These data, like those from most large observational studies, are quite unbalanced.</p>
<h3 data-number="2.3.1" id="ssec:insteval"><span class="header-section-number">2.3.1</span> The <em>insteval</em> Data</h3>
<p>The data are from a special evaluation of lecturers by students at the Swiss Federal Institute for Technology–Zürich (ETH–Zürich), to determine who should receive the “best-liked professor” award. These data have been slightly simplified and identifying labels have been removed, so as to preserve anonymity.</p>
<p>The variables</p>
<pre class="language-julia"><code>insteval = MixedModels.dataset(:insteval)</code></pre>
<pre class="output"><code>Arrow.Table with 73421 rows, 7 columns, and schema:
 :s        String
 :d        String
 :dept     String
 :studage  String
 :lectage  String
 :service  String
 :y        Int8</code></pre>
<pre class="language-julia"><code>insteval = DataFrame(insteval)
describe(insteval)</code></pre>
<table>
<caption>InstevalisDataFrame insteval describe insteval . {#tbl:instevalisDataFrame_insteval describe_insteval }</caption>
<thead>
<tr class="header">
<th style="text-align: right;">variable</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">min</th>
<th style="text-align: right;">median</th>
<th style="text-align: right;">max</th>
<th style="text-align: right;">nmissing</th>
<th style="text-align: right;">eltype</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">s</td>
<td style="text-align: right;">nothing</td>
<td style="text-align: right;">S0001</td>
<td style="text-align: right;">nothing</td>
<td style="text-align: right;">S2972</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">String</td>
</tr>
<tr class="even">
<td style="text-align: right;">d</td>
<td style="text-align: right;">nothing</td>
<td style="text-align: right;">I0001</td>
<td style="text-align: right;">nothing</td>
<td style="text-align: right;">I2160</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">String</td>
</tr>
<tr class="odd">
<td style="text-align: right;">dept</td>
<td style="text-align: right;">nothing</td>
<td style="text-align: right;">D01</td>
<td style="text-align: right;">nothing</td>
<td style="text-align: right;">D15</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">String</td>
</tr>
<tr class="even">
<td style="text-align: right;">studage</td>
<td style="text-align: right;">nothing</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">nothing</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">String</td>
</tr>
<tr class="odd">
<td style="text-align: right;">lectage</td>
<td style="text-align: right;">nothing</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">nothing</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">String</td>
</tr>
<tr class="even">
<td style="text-align: right;">service</td>
<td style="text-align: right;">nothing</td>
<td style="text-align: right;">N</td>
<td style="text-align: right;">nothing</td>
<td style="text-align: right;">Y</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">String</td>
</tr>
<tr class="odd">
<td style="text-align: right;">y</td>
<td style="text-align: right;">3.205744950354803</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.0</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">Int8</td>
</tr>
</tbody>
</table>
<p>have somewhat cryptic names. Factor <code>s</code> designates the student and <code>d</code> the instructor. The factor <code>dept</code> is the department for the course and <code>service</code> indicates whether the course was a service course taught to students from other departments.</p>
<p>Although the response, <code>y</code>, is on a scale of 1 to 5,</p>
<pre class="language-julia"><code>hist(insteval.y)</code></pre>
<figure>
<img src="/im/insteval_hist.svg" id="fig:instevalhist" alt="Figure 6: Histogram of instructor ratings in the insteval data" /><figcaption aria-hidden="true">Figure 6: Histogram of instructor ratings in the <em>insteval</em> data</figcaption>
</figure>
<p>it is sufficiently diffuse to warrant treating it as if it were a continuous response.</p>
<p>At this point we will fit models that have random effects for student, instructor, and department (or the combination) to these data. In the next chapter we will fit models incorporating fixed-effects for instructor and department to these data.</p>
<pre class="language-julia"><code>m6 = fit(
    MixedModel,
    @formula(y ~ 1 + (1|s) + (1|d) + (1|dept)),
    insteval;
    thin=1,
)</code></pre>
<pre class="language-plain"><code>Linear mixed model fit by maximum likelihood
 y ~ 1 + (1 | s) + (1 | d) + (1 | dept)
    logLik     -2 logLik       AIC         AICc          BIC     
 -118884.7862  237769.5724  237779.5724  237779.5732  237825.5922

Variance components:
            Column   Variance Std.Dev. 
s        (Intercept)  0.106551 0.326421
d        (Intercept)  0.267584 0.517286
dept     (Intercept)  0.005983 0.077348
Residual              1.387076 1.177742
 Number of obs: 73421; levels of grouping factors: 2972, 1128, 14

  Fixed-effects parameters:
──────────────────────────────────────────────────
               Coef.  Std. Error       z  Pr(&gt;|z|)
──────────────────────────────────────────────────
(Intercept)  3.25193   0.0278669  116.70    &lt;1e-99
──────────────────────────────────────────────────</code></pre>
<p>(Fitting this complex model to a moderately large data set takes less than two minutes on a modest laptop computer purchased in 2006. Although this is more time than required for earlier model fits, it is a remarkably short time for fitting a model of this size and complexity. In some ways it is remarkable that such a model can be fit at all on such a computer.)</p>
<p>All three estimated standard deviations of the random effects are less than <span class="math inline">\(\widehat{\sigma}\)</span>, with <span class="math inline">\(\widehat{\sigma}_3\)</span>, the estimated standard deviation of the random effects for the interaction, less than one-tenth the estimated residual standard deviation.</p>
<p>It is not surprising that zero is within all of the prediction intervals on the random effects for this factor (Fig. <a href="#fig:fm05ranef" data-reference-type="ref" data-reference="fig:fm05ranef">[fig:fm05ranef]</a>). In fact, zero is close to the middle of all these prediction intervals. However, the p-value for the LRT of <span class="math inline">\(H_0:\sigma_3=0\)</span> versus <span class="math inline">\(H_a:\sigma_3&gt;0\)</span></p>
<p>is highly significant. That is, we have very strong evidence that we should reject <span class="math inline">\(H_0\)</span> in favor of <span class="math inline">\(H_a\)</span>.</p>
<p>The seeming inconsistency of these conclusions is due to the large sample size (<span class="math inline">\(n=73421\)</span>). When a model is fit to a very large sample even the most subtle of differences can be highly “statistically significant.” The researcher or data analyst must then decide if these terms have practical significance, beyond the apparent statistical significance.</p>
<p>The large sample size also helps to assure that the parameters have good normal approximations. We could profile this model fit but doing so would take a very long time and, in this particular case, the analysts are more interested in a model that uses fixed-effects parameters for the instructors, which we will describe in the next chapter.</p>
<p>We could pursue other mixed-effects models here, such as using the factor and not the interaction to define random effects, but we will revisit these data in the next chapter and follow up on some of these variations there.</p>
<figure>
<img src="figure/Multiple-fm05Limage" id="fig:fm05Limage" alt="Figure 7: Image of the sparse Cholesky factor, \mathbf{L}, from model" /><figcaption aria-hidden="true">Figure 7: Image of the sparse Cholesky factor, <span class="math inline">\(\mathbf{L}\)</span>, from model</figcaption>
</figure>
<h3 data-number="2.3.2" id="sec:fm05L"><span class="header-section-number">2.3.2</span> Structure of <span class="math inline">\(\mathbf{L}\)</span> for model <code>fm05</code></h3>
<p>Before leaving this model we examine the sparse Cholesky factor, <span class="math inline">\(\vec L\)</span>, (Fig. <a href="#fig:fm05Limage" data-reference-type="ref" data-reference="fig:fm05Limage">1.1</a>), which is of size <span class="math inline">\(4128\times4128\)</span>. Even as a sparse matrix this factor requires a considerable amount of memory,</p>
<p>but as a triangular dense matrix it would require nearly 10 times as much. There are <span class="math inline">\((4128\times 4129)/2\)</span> elements on and below the diagonal, each of which would require 8 bytes of storage. A packed lower triangular array would require</p>
<p>megabytes. The more commonly used full rectangular storage requires</p>
<p>megabytes of storage.</p>
<p>The number of nonzero elements in this matrix that must be updated for each evaluation of the deviance is</p>
<p>Comparing this to , the number of elements that must be updated in a dense Cholesky factor, we can see why the sparse Cholesky factor provides a much more efficient evaluation of the profiled deviance function.</p>


<div class="bottom-nav">
    <p id="nav-prev" style="text-align: left;">
        <a class="menu-level-2" href="/NestedRE"><b>2.2</b> A Model With Nested Ra..</a> <kbd>←</kbd>
        <span id="nav-next" style="float: right;">
            <kbd>→</kbd> <a class="menu-level-2" href="/MultSummary"><b>2.4</b> Chapter Summary</a>
        </span>
    </p>
</div>


<div class="license">
    <br/>
  <br/>
  <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a>
    Phillip Alday, Dave Kleinschmidt, Reinhold Kliegl, Douglas Bates
</div>
</div>
</div>
</body>
</html>