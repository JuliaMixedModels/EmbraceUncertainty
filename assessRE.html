<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="Phillip Alday" />
  <meta name="author" content="Dave Kleinschmidt" />
  <meta name="author" content="Reinhold Kliegl" />
  <meta name="author" content="Douglas Bates" />
  <title>Assessing the random effects - Embrace Uncertainty</title>
  <link rel="shortcut icon" type="image/png" href="/favicon.png"/>
  <link rel="stylesheet" href="/style.css"/>
    <script src="/mousetrap.min.js"></script>
    <!-- TODO: Add url_prefix. -->
  <style>
  @font-face {
    font-family: JuliaMono-Regular;
    src: url("/JuliaMono-Regular.woff2");
  }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
  <link rel="stylesheet" href="/github.min.css">
<script src="/highlight.min.js"></script>
<script src="/julia.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', (event) => {
    document.querySelectorAll('pre').forEach((el) => {
        hljs.highlightElement(el);
    });
});
</script>
 
</head>
<body>
<script>
function click_next() {
  var next = document.getElementById('nav-next');
  next.firstElementChild.nextElementSibling.click();
}
function click_prev() {
  var prev = document.getElementById('nav-prev');
  prev.firstElementChild.click();
}
Mousetrap.bind('right', click_next);
Mousetrap.bind('h', click_prev);
Mousetrap.bind('left', click_prev);
Mousetrap.bind('l', click_next);
</script>

<div class="books-container">
<aside class="books-menu">
<input type="checkbox" id="menu">
<label for="menu">☰</label>
<div class="books-title">
<a href="/">Embrace Uncertainty</a>
</div><br />
<span class="books-subtitle">
Fitting Mixed-Effects Models with Julia
</span>
<div class="books-menu-content">
<li><a class="menu-level-1" href="/ExamLMM"><b>1</b> A Simple, Linear, Mixed-..</a></li>
<li><a class="menu-level-2" href="/memod"><b>1.1</b> Mixed-effects models</a></li>
<li><a class="menu-level-2" href="/DyestuffData"><b>1.2</b> The dyestuff and dyest..</a></li>
<li><a class="menu-level-2" href="/FittingLMMs"><b>1.3</b> Fitting linear mixed m..</a></li>
<li><a class="menu-level-2" href="/Probability"><b>1.4</b> The linear mixed-effec..</a></li>
<li><a class="menu-level-2" href="/variability"><b>1.5</b> Assessing the variabil..</a></li>
<li><a class="menu-level-2" href="/assessRE"><b>1.6</b> Assessing the random e..</a></li>
<li><a class="menu-level-2" href="/ChIntroSummary"><b>1.7</b> Chapter summary</a></li>
<li><a class="menu-level-1" href="/Multiple"><b>2</b> Models With Multiple Ran..</a></li>
<li><a class="menu-level-2" href="/crossedRE"><b>2.1</b> A Model With Crossed R..</a></li>
<li><a class="menu-level-2" href="/NestedRE"><b>2.2</b> A Model With Nested Ra..</a></li>
<li><a class="menu-level-2" href="/partially"><b>2.3</b> A Model With Partially..</a></li>
<li><a class="menu-level-2" href="/MultSummary"><b>2.4</b> Chapter Summary</a></li>
<li><a class="menu-level-1" href="/longitudinal"><b>3</b> # Models for Longitudina..</a></li>
<li><a class="menu-level-2" href="/sleep"><b>3.1</b> Data</a></li>
<li><a class="menu-level-2" href="/SleepMixed"><b>3.2</b> Data</a></li>
<li><a class="menu-level-2" href="/assess-prec-param"><b>3.3</b> Assessing the Precisio..</a></li>
<li><a class="menu-level-2" href="/fm07re"><b>3.4</b> Examining the Random E..</a></li>
<li><a class="menu-level-2" href="/chapter-summary"><b>3.5</b> Chapter Summary</a></li>
<li><a class="menu-level-1" href="/computational"><b>4</b> Computational Methods fo..</a></li>
<li><a class="menu-level-2" href="/defnLMM"><b>4.1</b> Definitions and Basic ..</a></li>
<li><a class="menu-level-2" href="/conddistUgivenY"><b>4.2</b> </a></li>
<li><a class="menu-level-2" href="/IntegratingH"><b>4.3</b> in the Linear Mixed Mo..</a></li>
<li><a class="menu-level-2" href="/PLSsol"><b>4.4</b> </a></li>
<li><a class="menu-level-2" href="/REML"><b>4.5</b> The REML Criterion</a></li>
<li><a class="menu-level-2" href="/stepByStep"><b>4.6</b> Step-by-step Evaluatio..</a></li>
<li><a class="menu-level-2" href="/general"><b>4.7</b> Generalizing to Other ..</a></li>
<li><a class="menu-level-2" href="/lmmsummary"><b>4.8</b> Chapter Summary</a></li>
<li><a class="menu-level-1" href="/GLMMbinomial"><b>5</b> Generalized Linear Mixed..</a></li>
<li><a class="menu-level-2" href="/contraception"><b>5.1</b> Artificial contracepti..</a></li>
<li><a class="menu-level-2" href="/GLMMlink"><b>5.2</b> Link functions and int..</a></li>
<li><a class="menu-level-1" href="/references"><b></b> References</a></li>
</div>
</aside>

<div class="books-content">
<h2 data-number="1.6" id="sec:assessRE"><span class="header-section-number">1.6</span> Assessing the random effects</h2>
<p>In Section <a href="/Probability#sec:definitions">1.4.1</a> we mentioned that what are sometimes called the BLUPs (or best linear unbiased predictors) of the random effects, <span class="math inline">\(\mathcal{B}\)</span>, are the conditional modes evaluated at the parameter estimates, calculated as <span class="math inline">\(\tilde{\mathbf{b}}_{\widehat{\theta}}=\Lambda_{\widehat{\theta}}\tilde{\mathbf{u}}_{\widehat{\theta}}\)</span>.</p>
<p>These values are often considered as some sort of “estimates” of the random effects. It can be helpful to think of them this way but it can also be misleading. As we have stated, the random effects are not, strictly speaking, parameters — they are unobserved random variables. We don’t estimate the random effects in the same sense that we estimate parameters. Instead, we consider the conditional distribution of <span class="math inline">\(\mathcal{B}\)</span> given the observed data, <span class="math inline">\((\mathcal{B}|\mathcal{Y}=\mathbf{y})\)</span>.</p>
<p>Because the unconditional distribution, <span class="math inline">\(\mathcal{B}\sim\mathcal{N}(\mathbf{0},\Sigma_\theta)\)</span> is continuous, the conditional distribution, <span class="math inline">\((\mathcal{B}|\mathcal{Y}=\mathbf{y})\)</span> will also be continuous. In general, the mode of a probability density is the point of maximum density, so the phrase “conditional mode” refers to the point at which this conditional density is maximized. Because this definition relates to the probability model, the values of the parameters are assumed to be known. In practice, of course, we don’t know the values of the parameters (if we did there would be no purpose in forming the parameter estimates), so we use the estimated values of the parameters to evaluate the conditional modes.</p>
<p>Those who are familiar with the multivariate Gaussian distribution may recognize that, because both <span class="math inline">\(\mathcal{B}\)</span> and <span class="math inline">\((\mathcal{Y}|\mathcal{B}=\mathbf{b})\)</span> are multivariate Gaussian, <span class="math inline">\((\mathcal{B}|\mathcal{Y}=\mathbf{y})\)</span> will also be multivariate Gaussian and the conditional mode will also be the conditional mean of <span class="math inline">\(\mathcal{B}\)</span>, given <span class="math inline">\(\mathcal{Y}=\mathbf{y}\)</span>. This is the case for a linear mixed model but it does not carry over to other forms of mixed models. In the general case all we can say about <span class="math inline">\(\tilde{\mathbf{u}}\)</span> or <span class="math inline">\(\tilde{\mathbf{b}}\)</span> is that they maximize a conditional density, which is why we use the term “conditional mode” to describe these values. We will only use the term “conditional mean” and the symbol, <span class="math inline">\(\mathbf{\mu}\)</span>, in reference to <span class="math inline">\(\mathrm{E}(\mathcal{Y}|\mathcal{B}=\mathbf{b})\)</span>, which is the conditional mean of <span class="math inline">\(\mathcal{Y}\)</span> given <span class="math inline">\(\mathcal{B}\)</span>, and an important part of the formulation of all types of mixed-effects models.</p>
<p>The conditional modes are available as a vector of matrices</p>
<pre class="language-julia"><code>only(m1.b)</code></pre>
<pre class="output"><code>1×6 Matrix{Float64}:
 -16.6282  0.369516  26.9747  -21.8014  53.5798  -42.4943</code></pre>
<p>In this case the vector consists of a single matrix because there is only one random-effects term, <code>(1|batch)</code>, in the model and, hence, only one grouping factor, <code>batch</code>, for the random effects. There is only one row in the matrix because the random-effects term, <code>(1|batch)</code>, is a simple, scalar term.</p>
<p>To make this more explicit, random-effects terms in the model formula are those that contain the vertical bar (<code>|</code>) character. The variable or expression on the right of the <code>|</code> is the grouping factor for the random effects generated by this term. If the expression on the left of the vertical bar is <code>1</code>, as it is here, we describe the term as a <em>simple, scalar, random-effects term</em>. The designation “scalar” means there will be exactly one random effect generated for each level of the grouping factor. A simple, scalar term generates a block of indicator columns — the indicators for the grouping factor — in <span class="math inline">\(\mathbf{Z}\)</span>. Because there is only one random-effects term in this model and because that term is a simple, scalar term, the model matrix <span class="math inline">\(\mathbf{Z}\)</span> for this model is the indicator matrix for the levels of <code>batch</code>.</p>
<p>In the next chapter we fit models with multiple simple, scalar terms and, in subsequent chapters, we extend random-effects terms beyond simple, scalar terms. When we have only simple, scalar terms in the model, each term has a unique grouping factor and the elements of the list returned by can be considered as associated with terms or with grouping factors. In more complex models a particular grouping factor may occur in more than one term. In such cases the terms associated with the same grouping factor are internally amalgamated into a single term. Thus internally the random effects are associated with grouping factors, not the terms in the model formula.</p>
<p>Given the data, <span class="math inline">\(\mathbf{y}\)</span>, and the parameter estimates, we can evaluate a measure of the dispersion of <span class="math inline">\((\mathcal{B}|\mathcal{Y}=\mathbf{y})\)</span>. In the case of a linear mixed model, this is the conditional standard deviation, from which we can obtain a prediction interval. A plot of these prediction intervals is sometimes called a <em>caterpillar plot</em> because it can look like a fuzzy caterpillar when there are many levels of the grouping factor.</p>
<pre class="language-julia"><code>caterpillar(m1)</code></pre>
<figure>
<img src="/im/caterpillar_m1.svg" id="fig:caterpillar_m1" alt="Figure 3: Caterpillar plot of prediction intervals for m1 random effects" /><figcaption aria-hidden="true">Figure 3: Caterpillar plot of prediction intervals for m1 random effects</figcaption>
</figure>
<p>The <code>caterpillar</code> function returns a plot with linear spacing of the levels on the y axis. An alternative</p>
<pre class="language-julia"><code>qqcaterpillar(m1)</code></pre>
<figure>
<img src="/im/qqcaterpillar_m1.svg" id="fig:qqcaterpillar_m1" alt="Figure 4: Quantile caterpillar plot of prediction intervals for m1 random effects" /><figcaption aria-hidden="true">Figure 4: Quantile caterpillar plot of prediction intervals for m1 random effects</figcaption>
</figure>
<p>returns a plot where the intervals are plotted with vertical spacing corresponding to the quantiles of the standard normal distribution.</p>
<p>The <code>caterpillar</code> plot is preferred when there are only a few levels of the grouping factor, as in this case. When there are hundreds or thousands of random effects the <code>qqcaterpillar</code> form is preferred because it focuses attention on the “important few” at the extremes and de-emphasizes the “trivial many” that are close to zero.</p>


<div class="bottom-nav">
    <p id="nav-prev" style="text-align: left;">
        <a class="menu-level-2" href="/variability"><b>1.5</b> Assessing the variabil..</a> <kbd>←</kbd>
        <span id="nav-next" style="float: right;">
            <kbd>→</kbd> <a class="menu-level-2" href="/ChIntroSummary"><b>1.7</b> Chapter summary</a>
        </span>
    </p>
</div>


<div class="license">
    <br/>
  <br/>
  <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a>
    Phillip Alday, Dave Kleinschmidt, Reinhold Kliegl, Douglas Bates
</div>
</div>
</div>
</body>
</html>